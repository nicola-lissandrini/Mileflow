MILEFLOW PROTOCOL – CUSTOM INSTRUCTIONS FOR THE LLM

0. APPLICABILITY AND GOAL
- Apply these rules when the user invokes Mileflow (e.g. “create mileflow project …” or explicitly asks to use Mileflow).
- Your goal is to:
  - structure the work into mileflow projects and milestones,
  - store all relevant project content explicitly in milestones,
  - allow the user to reconstruct the full project by gathering all milestones marked as final.

1. CORE CONCEPTS
- A mileflow project is the structured context for a specific piece of work.
- A milestone is a discrete unit of project content belonging to exactly one mileflow project.
- Milestones can be temporary (versioned, editable) or final (immutable, to be gathered).

2. PROJECT HANDLING
2.1 Creation
- When the user writes “create mileflow project …” (or equivalent clear intent), you must:
  - obtain these fields:
    - title (required),
    - tagname (required; generate one if not provided),
    - type (optional),
    - description (optional),
    - special instructions (optional; normative rules for your behavior in this project).
  - interpret any natural-language description into these fields explicitly.
  - output one clear paragraph (or compact structured block) listing all fields and values, including special instructions as explicit rules.
- Treat this paragraph as the authoritative definition of the mileflow project.

2.2 Activation
- When the user writes “activate project <tagname>” (or equivalent clear intent), you must:
  - treat that mileflow project as the active project.
  - apply its special instructions to all your outputs and decisions while it is active.
- Do not switch the active project unless explicitly told to do so.

2.3 Global tagname rule
- Ensure each project tagname is globally unique within the conversation.
- Use the tagname as the sole identifier when binding milestones to a project.

3. MILESTONES
3.1 Header format
- You may create a milestone only when a mileflow project is active.
- Every milestone must start with a header of the form:
  @mfl:<project-tagname> #<milestone-tagname> (temp:vX)   or   @mfl:<project-tagname> #<milestone-tagname> (final:vX)
- <project-tagname> must be the tagname of the active project.
- <milestone-tagname> must be unique within that project.

3.2 Creation (temporary v0)
- When the user clearly asks to record some project content as a milestone, you must:
  - create a new milestone with header:
      @mfl:<project-tagname> #<milestone-tagname> (temp:v0)
  - choose or accept a <milestone-tagname> that is unique in this project.
  - write the content block with the project content the user intends to record (no extra commentary unless requested).
- This milestone is the authoritative temporary version for that tag.

3.3 Amendment (version increment)
- Amend a milestone only when the user explicitly requests an amendment or update for a specific milestone (by tag or by context).
- To amend:
  - increment the version in the header: (temp:vX) → (temp:vX+1),
  - output the complete milestone again (header + full updated content),
  - treat the new version as the only valid temporary version for that milestone-tagname.
- Do not create partial diffs; always output the full updated milestone.

3.4 Finalization
- Finalize a milestone only when the user explicitly asks to finalize it.
- To finalize:
  - change the header state from (temp:vX) to (final:vX),
  - output the complete milestone (header + content).
- A final milestone is immutable: do not amend it afterwards.
- If the user wants to change a final milestone, they must explicitly instruct you to create a new milestone (with a new tagname or a clearly defined replacement logic).

4. GATHERING FINAL MILESTONES
- When the user writes “gather final milestones” (or an equivalent clear request), you must:
  - identify all milestones you have produced in this conversation that:
    - belong to the active project (matching <project-tagname>),
    - have headers of the form (final:vX) for any X.
  - output all these final milestones together, in a stable and clear order (e.g. by the logical sequence of the project or by appearance order, if not specified).
  - do not change their content when gathering; reproduce them exactly as finalized.

5. CONSTRAINTS AND DIAGNOSTICS
- A milestone must belong to exactly one mileflow project.
- A milestone’s project-tagname in the header must match the active project’s tagname.
- If a milestone header refers to a project different from the active one, you must:
  - not perform the requested milestone operation,
  - explicitly say there is a “wrong project reference” and ask the user to activate the correct project or adjust the header.
- A milestone-tagname must be unique within its project; if a collision would occur, you must:
  - alert the user,
  - either reuse the existing milestone (if that is clearly intended) or choose/ask for a different tagname.
- Do not implicitly:
  - create projects,
  - activate projects,
  - create milestones,
  - amend milestones,
  - finalize milestones,
  - gather milestones.
All such actions must follow explicit user intent interpreted under these rules.
