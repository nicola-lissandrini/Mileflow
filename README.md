# Mileflow

## Introduction
When using an LLM to develop a project across many steps, the conversation quickly accumulates information that is difficult to reference, validate, update, or consolidate. The absence of explicit structure makes it unclear which parts of the dialogue represent verified project content, which parts are tentative, and how to recover a complete specification once the work is finished.

Mileflow defines a formal method for structuring long-form, multi-step project development within an LLM interaction. It introduces two core constructs:

* **projects**, which establish explicit contextual boundaries, metadata, and project-specific behavioral rules;
* **milestones**, which represent discrete units of verified project content that can be revised while temporary and fixed once final.

The protocol ensures that:

* every piece of information belonging to a project is recorded explicitly rather than implicitly scattered across dialogue;
* updates occur deterministically through versioned amendments;
* final project content can be gathered unambiguously at any stage;
* the LLM’s behavior aligns with the project’s instructions and constraints.

Mileflow’s general purpose is to impose clarity, stability, and recoverability on LLM-driven project development, enabling the construction of coherent, inspectable, and formally structured outputs across extended interactions.

## Mileflow Protocol
###  System Layer Specification

Mileflow is a protocol defining how an LLM must structure interaction with the user by organizing work into:

* **mileflow projects**, each representing a distinct structured context, and
* **milestones**, each representing a verified and self-contained fragment of that project.

The protocol directs the LLM to:

1. treat each project as a formal container with its own metadata and behavioral instructions;
2. record project information exclusively through milestones;
3. allow milestone content to be revised while temporary, and fixed once final;
4. gather all final milestones to reconstruct the complete, authoritative output of a project.

All rules apply to how the LLM interprets and produces text during the interaction.

#### Projects

A **mileflow project** is an LLM-level construct consisting of:

* a unique **tagname**;
* required metadata: **title**;
* optional metadata: **type**, **description**;
* optional **special instructions** that define normative behavioral constraints for the LLM while the project is active.

A project exists solely through its definition in the conversation, and must be explicitly activated before milestones can be created or modified.


#### Milestones

A **milestone** is a structured text element associated with exactly one mileflow project.

A milestone:

* contains formally written content representing a precise portion of the project;
* may be created in **temporary** form and updated through versioning;
* may be declared **final**, after which it is immutable;
* contributes, when final, to the set gathered to form the project’s consolidated output.


#### System Constraints

1. A milestone cannot be created unless a mileflow project has been explicitly activated.
2. Every milestone must reference its mileflow project in its header.
3. The LLM must apply the special instructions of the active project to all operations within that project.
4. If a milestone header references a project different from the active one, the LLM must issue a *wrong project reference* diagnostic.
5. All final milestones must be gatherable without ambiguity to reconstruct the mileflow project's output.

### Project Layer Specifications
#### Project Creation 

A mileflow project is created when the user issues a creation command.
The canonical form is:

```
create mileflow project <descriptor>
```

Upon receiving this command, the LLM must construct a project definition with the following fields:

* **title** : string — required
* **tagname** : string — required (generated by the LLM if not provided)
* **type** : string — optional
* **description** : string — optional
* **special instructions** : list of normative statements — optional

Rules:

1. The LLM must accept these fields as provided in natural language and map them unambiguously to the fields above.
2. If **tagname** is not provided, the LLM must generate a short, unique identifier consistent with the project’s title.
3. After constructing the project, the LLM must output a a tightly structured paragraph block that explicitly lists all fields and their values, including all special instructions as normative sentences.
4. That paragraph constitutes the authoritative project definition for all subsequent operations and is the anchor the LLM must consult when reasoning about that mileflow project.

#### Project Activation

A mileflow project becomes the active project when the user issues an activation command referring to its tagname.
The canonical form is:

```
activate project <tagname>
```

Rules:

1. All milestone operations (creation, amendment, finalization, retrieval) implicitly refer to the active project.
2. The LLM must enforce the project’s special instructions for all interactions within the active project.
3. Activation remains in effect until another project is explicitly activated.
4. The LLM must not implicitly switch the active project.

#### Constraints

1. Each mileflow project’s **tagname** must be globally unique within the conversation.
2. The tagname is the only identifier used to bind milestones to that project.
3. The tagname must appear in every milestone header associated with that project.
4. Each milestone belongs to exactly one mileflow project.
5. A milestone must reference its project’s tagname explicitly in its header.
6. All milestone operations must occur within the context of the active project.
7. If a milestone header references a project different from the active one, the LLM must issue a *wrong project reference* diagnostic and abort that milestone operation.

#### Project Modification Rules

1. A project definition may be modified only when the user expresses explicit intent to change one or more fields.
2. After any modification, the LLM must output a new explicit project-definition paragraph reflecting the updated fields.
3. The latest such paragraph supersedes previous project definitions as the authoritative reference.

### Milestone Layer Specification 

#### Milestone Header

Every milestone must begin with a header of the form:

```
@mfl:<project-tagname> #<milestone-tagname> (temp:vX)
```

Explanation:

* `@mfl:` is the fixed marker indicating that the text block is a Mileflow milestone;
* `<project-tagname>` identifies the mileflow project the milestone belongs to;
* `#<milestone-tagname>` uniquely identifies the milestone within that project;
* `(temp:vX)` indicates the milestone is temporary and specifies its version number.

This header ensures that:

1. the LLM anchors the milestone to the correct project;
2. milestones can be gathered, referenced, and validated unambiguously.


#### Milestone Creation

A milestone may be created only when a mileflow project is active.

Creation rules:

1. The LLM generates a header in the canonical form above, with version `v0`.
2. The LLM writes the **content block**, which is the project content itself:

   * it expresses the information the user intends to record,
   * its structure and style depend entirely on the project.
3. The milestone is considered the authoritative temporary representation of that piece of the project.


#### Milestone Amendment

A temporary milestone may be amended following explicit user intent.

Canonical amend procedure:

1. The user issues an explicit amendment directive referencing the milestone’s tagname.
2. The LLM increments the version number `(temp:vX → temp:vX+1)`.
3. The LLM outputs a complete, updated milestone, with the same project-tagname and milestone-tagname, replacing all previous temporary versions.
4. Only one temporary version exists at any time for a given milestone-tagname.
5. Amendments occur only when requested; never implicitly.

#### Milestone Finalization

A milestone becomes final when the user expresses explicit intent to finalize it.

Rules:

1. The header state changes from `(temp:vX)` to `(final:vX)`.
2. A final milestone is immutable.
3. A final milestone becomes part of the set used to reconstruct the project’s complete output.

#### Milestone Gathering Command

The canonical command for retrieving all finalized milestones of a project is:

```
gather final milestones
```

When issued:

1. The LLM collects all milestones belonging to the **active project** that have `(final:vX)` state.
2. The LLM outputs them in an ordered, unambiguous list.
3. This set forms the project’s authoritative consolidated output.

If the user wishes to gather milestones for a non-active project, they must activate that project first.


#### Constraints and general behavior

The LLM must enforce the following behavior

1. Each milestone-tagname must be unique within its mileflow project.
2. A milestone must reference its project-tagname.
3. If the project-tagname in the header differs from the active project, the LLM must issue a *wrong project reference* diagnostic.

The LLM must reject the following operations:

* creating a milestone when no project is active;
* amending a milestone whose project-tagname does not match the active project;
* creating more than one temporary version for the same milestone-tagname;
* attempting to amend a finalized milestone.


## Conclusion

Mileflow provides a structured way to conduct multi-step project development within an LLM interaction. By defining explicit projects, versioned milestones, and a clear mechanism for finalizing and gathering content, it ensures that long conversations remain organized, consistent, and recoverable. The protocol promotes clarity in both reasoning and output, enabling complex work to be carried out reliably within a conversational medium.
